---
/**
 * SEO Head Component
 * 提供完整的 SEO meta tags：Open Graph、Twitter Cards、Canonical URL、結構化資料
 */

interface Props {
    title: string;
    description: string;
    image?: string;
    article?: {
        publishedTime: string;
        modifiedTime?: string;
        author?: string;
        tags?: string[];
    };
    noindex?: boolean;
}

const {
    title,
    description,
    image = "/icon.png",
    article,
    noindex = false,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const imageURL = new URL(image, Astro.site);

// JSON-LD 結構化資料
const websiteSchema = {
    "@context": "https://schema.org",
    "@type": "WebSite",
    name: "The Samo Log (薩摩日誌)",
    url: Astro.site?.toString(),
    description: "技術分享、思考與生活的個人部落格",
    inLanguage: "zh-TW",
};

const articleSchema = article
    ? {
          "@context": "https://schema.org",
          "@type": "BlogPosting",
          headline: title,
          description: description,
          image: imageURL.toString(),
          datePublished: article.publishedTime,
          dateModified: article.modifiedTime || article.publishedTime,
          author: {
              "@type": "Person",
              name: article.author || "Jay",
          },
          keywords: article.tags?.join(", "),
          mainEntityOfPage: {
              "@type": "WebPage",
              "@id": canonicalURL.toString(),
          },
      }
    : null;
---

<!-- Canonical URL -->
<link rel="canonical" href={canonicalURL} />

<!-- Robots -->
{noindex && <meta name="robots" content="noindex, nofollow" />}

<!-- Open Graph / Facebook -->
<meta property="og:type" content={article ? "article" : "website"} />
<meta property="og:url" content={canonicalURL} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={imageURL} />
<meta property="og:locale" content="zh_TW" />
<meta property="og:site_name" content="The Samo Log (薩摩日誌)" />

{
    article && (
        <>
            <meta
                property="article:published_time"
                content={article.publishedTime}
            />
            {article.modifiedTime && (
                <meta
                    property="article:modified_time"
                    content={article.modifiedTime}
                />
            )}
            {article.tags?.map((tag) => (
                <meta property="article:tag" content={tag} />
            ))}
        </>
    )
}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={canonicalURL} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={imageURL} />

<!-- JSON-LD 結構化資料 -->
<script
    type="application/ld+json"
    set:html={JSON.stringify(article ? articleSchema : websiteSchema)}
/>
